<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vertex AI - Gemini Live (Branded Voice App)</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

  <script type="importmap">
    {
      "imports": {
        "@material/web/": "https://esm.run/@material/web/"
      }
    }
    </script>
  <script type="module">
    import "@material/web/all.js";
    import { styles as typescaleStyles } from "@material/web/typography/md-typescale-styles.js";

    document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
  </script>

  <script src="gemini-live-api.js"></script>
  <script src="live-media-manager.js"></script>
  <script src="cookieJar.js"></script>

  <link rel="stylesheet" href="styles.css" />
  <script defer src="script.js"></script>

  <style>
    /* --- General Styling & Variables from BrandedVoice.html --- */
    :root {
      --gcp-bg: #F8F9FA;
      --gcp-surface: #FFFFFF;
      --gcp-blue: #1A73E8;
      --gcp-blue-hover: #1765CC;
      --gcp-text-primary: #202124;
      --gcp-text-secondary: #5F6368;
      --gcp-border: #DADCE0;
      --gcp-sidebar-bg: #F1F3F4;
      --gcp-active-blue-bg: #E8F0FE;
      --font-family: 'Roboto', sans-serif;
    }

    body {
      margin: 0;
      font-family: var(--font-family);
      background-color: var(--gcp-bg);
      color: var(--gcp-text-primary);
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    /* --- Header --- */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 16px;
      border-bottom: 1px solid var(--gcp-border);
      background-color: var(--gcp-surface);
      flex-shrink: 0;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .header-left .logo {
      font-weight: 500;
      font-size: 18px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .header-right .material-icons {
      color: var(--gcp-text-secondary);
    }

    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: #FDBAAB;
    }

    /* --- Main Container Layout --- */
    .app-container {
      display: flex;
      flex-grow: 1;
      overflow: hidden;
    }

    /* --- Left Sidebar --- */
    .left-sidebar {
      width: 240px;
      background-color: var(--gcp-surface);
      padding: 16px 8px;
      border-right: 1px solid var(--gcp-border);
      flex-shrink: 0;
      overflow-y: auto;
    }

    .nav-item {
      display: flex;
      align-items: center;
      padding: 8px 16px;
      margin: 2px 0;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    .nav-item .material-icons {
      margin-right: 20px;
      font-size: 20px;
      color: var(--gcp-text-secondary);
    }

    .nav-item.active {
      background-color: var(--gcp-active-blue-bg);
      color: var(--gcp-blue);
      font-weight: 500;
    }

    .nav-item.active .material-icons {
      color: var(--gcp-blue);
    }

    .nav-header {
      font-size: 13px;
      font-weight: 500;
      padding: 16px 16px 8px;
      color: var(--gcp-text-secondary);
    }

    /* --- Main Content Area --- */
    .main-content {
      flex-grow: 1;
      padding: 24px 32px;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    .main-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 24px;
    }

    .main-header h1 {
      font-size: 20px;
      font-weight: 500;
      margin: 0;
    }

    /* --- Right Sidebar --- */
    .right-sidebar {
      width: 360px;
      background-color: var(--gcp-surface);
      border-left: 1px solid var(--gcp-border);
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      flex-shrink: 0;
      overflow-y: auto;
    }

    .config-section {
      padding: 16px;
      border: 1px solid var(--gcp-border);
      border-radius: 8px;
    }

    .config-section h3 {
      margin: 0 0 16px;
      font-size: 14px;
      font-weight: 500;
    }

    .config-section md-outlined-text-field,
    .config-section md-outlined-select {
      width: 100%;
      margin-bottom: 16px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .button-group {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }

    /* --- Collapsible sections from styles.css --- */
    details>summary {
      list-style: none;
      cursor: pointer;
    }

    details>summary::-webkit-details-marker {
      display: none;
    }

    details .details-content {
      padding-top: 16px;
    }

    /* --- Modal for Branded Voice Creation from BrandedVoice.html --- */
    .create-voice-link {
      color: var(--gcp-blue);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      margin-top: 12px;
      display: inline-block;
    }

    .create-voice-link:hover {
      text-decoration: underline;
    }

    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      display: none;
      /* Hidden by default */
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: var(--gcp-surface);
      padding: 24px;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 20px;
    }

    .close-button {
      cursor: pointer;
      background: none;
      border: none;
      font-size: 24px;
      color: var(--gcp-text-secondary);
    }

    .modal-body .form-group {
      margin-bottom: 20px;
    }

    .record-section {
      background-color: var(--gcp-bg);
      border: 1px solid var(--gcp-border);
      border-radius: 8px;
      padding: 16px;
      margin-top: 16px;
    }

    .record-section p {
      color: var(--gcp-text-secondary);
      font-size: 14px;
      line-height: 1.6;
    }

    .record-controls {
      margin-top: 16px;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    #recordButton {
      background-color: var(--gcp-blue);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #recordButton:disabled {
      background-color: #E0E0E0;
      cursor: not-allowed;
      color: var(--gcp-text-secondary);
    }

    #recordStatus {
      font-size: 14px;
      font-weight: 500;
      color: var(--gcp-text-secondary);
    }
  </style>
</head>

<body>

  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <span class="material-icons">menu</span>
      <div class="logo">Google Cloud</div>
    </div>
    <div class="header-right">
      <span class="material-icons">help_outline</span>
      <span class="material-icons">notifications</span>
      <span class="material-icons">apps</span>
      <div class="user-avatar"></div>
    </div>
  </header>

  <!-- App Container -->
  <div class="app-container">
    <!-- Left Sidebar -->
    <nav class="left-sidebar">
      <div class="nav-item"><span class="material-icons">dashboard</span> Dashboard</div>
      <div class="nav-item"><span class="material-icons">interests</span> Model Garden</div>
      <div class="nav-header">Vertex AI Studio</div>
      <div class="nav-item"><span class="material-icons">edit</span> Create prompt</div>
      <div class="nav-item"><span class="material-icons">perm_media</span> Media Studio</div>
      <div class="nav-item active"><span class="material-icons">sensors</span> Stream realtime</div>
      <div class="nav-item"><span class="material-icons">collections_bookmark</span> Prompt gallery</div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <div class="main-header">
        <span class="material-icons">arrow_back</span>
        <h1>Gemini Live</h1>
      </div>

      <div id="model-state">
        <div id="disconnected" class="state"><span class="material-symbols-outlined">cloud_off</span><span
            class="icon-text">disconnected</span></div>
        <div id="connecting" class="state" hidden><span class="material-symbols-outlined">hourglass_empty</span><span
            class="icon-text">connecting...</span></div>
        <div id="connected" class="state" hidden><span class="material-symbols-outlined">cloud_done</span><span
            class="icon-text">connected</span></div>
        <div id="speaking" class="state" hidden><span class="material-symbols-outlined">graphic_eq</span><span
            class="icon-text">model speaking</span></div>
      </div>

      <div id="video-preview-container" style="margin-top: 16px;">
        <video id="video" autoplay playsinline muted></video>
        <canvas id="canvas" style="display: none;"></canvas>
      </div>

      <div class="media-controls" style="margin-top: 16px;">
        <md-outlined-select id="cameraSource" label="Camera" onchange="newCameraSelected()"></md-outlined-select>
        <md-outlined-select id="audioSource" label="Microphone" onchange="newMicSelected()"></md-outlined-select>
        <span id="micBtn"><md-filled-icon-button
            onclick="micBtnClick()"><md-icon>mic</md-icon></md-filled-icon-button></span>
        <span id="micOffBtn" hidden><md-filled-icon-button
            onclick="micOffBtnClick()"><md-icon>mic_off</md-icon></md-filled-icon-button></span>
        <span id="cameraBtn"><md-filled-icon-button
            onclick="cameraBtnClick()"><md-icon>videocam</md-icon></md-filled-icon-button></span>
        <span id="cameraOffBtn" hidden><md-filled-icon-button
            onclick="cameraOffBtnClick()"><md-icon>videocam_off</md-icon></md-filled-icon-button></span>
        <span id="screenBtn"><md-filled-icon-button
            onclick="screenShareBtnClick()"><md-icon>present_to_all</md-icon></md-filled-icon-button></span>
      </div>

      <div id="chat-container" style="margin-top: 16px; flex-grow: 1;">
        <div id="text-chat" style="height: auto; flex-grow: 1;"></div>
        <div class="text-input-area">
          <md-outlined-text-field id="text-message" label="Send a text message"></md-outlined-text-field>
          <md-icon-button onclick="newUserMessage()"><md-icon>send</md-icon></md-icon-button>
        </div>
      </div>

    </main>

    <!-- Right Sidebar (Configuration) -->
    <aside class="right-sidebar">
      <div class="config-section">
        <h3>Connection</h3>
        <md-outlined-text-field id="token" label="Access Token" type="password" value=""></md-outlined-text-field>
        <md-outlined-text-field id="project" label="Project ID"
          value="visionai-testing-stable"></md-outlined-text-field>
        <md-outlined-select label="Environment" id="envApiHost">
          <md-select-option selected value="autopush">
            <div slot="headline">autopush</div>
          </md-select-option>
          <md-select-option value="staging">
            <div slot="headline">staging</div>
          </md-select-option>
          <md-select-option value="prod">
            <div slot="headline">prod</div>
          </md-select-option>
        </md-outlined-select>
        <div class="button-group">
          <md-filled-button onclick="connectBtnClick()">Connect</md-filled-button>
          <md-outlined-button onclick="disconnectBtnClick()">Disconnect</md-outlined-button>
        </div>
      </div>

      <details class="config-section" hidden>
        <summary>
          <h3>Model Behavior</h3>
        </summary>
        <div class="details-content">
          <p class="md-typescale-body-medium" style="margin-top: 0; margin-bottom: 16px;">Model response type
          </p>
          <form>
            <md-radio id="audio-radio" name="responseModality" value="AUDIO" checked></md-radio>
            <label for="audio-radio">Audio</label>
            <md-radio id="text-radio" name="responseModality" value="TEXT" style="margin-left: 24px;"></md-radio>
            <label for="text-radio">Text</label>
          </form>
          <br />
          <md-outlined-text-field id="systemInstructions" type="textarea" label="System Instructions"
            rows="3"></md-outlined-text-field>
        </div>
      </details>

      <div class="config-section" hidden>
        <h3>Outputs</h3>
        <div class="form-grid">
          <md-outlined-select label="Voice Name" id="voiceName">
            <md-select-option selected value="puck">
              <div slot="headline">puck</div>
            </md-select-option>
            <md-select-option value="charon">
              <div slot="headline">charon</div>
            </md-select-option>
            <md-select-option value="kore">
              <div slot="headline">kore</div>
            </md-select-option>
            <md-select-option value="fenrir">
              <div slot="headline">fenrir</div>
            </md-select-option>
            <md-select-option value="aoede">
              <div slot="headline">aoede</div>
            </md-select-option>
            <md-select-option value="orus">
              <div slot="headline">orus</div>
            </md-select-option>
            <md-select-option value="zephyr">
              <div slot="headline">zephyr</div>
            </md-select-option>
            <md-select-option value="leda">
              <div slot="headline">leda</div>
            </md-select-option>
          </md-outlined-select>
          <md-outlined-select label="Voice Locale" id="voiceLocale">
            <md-select-option selected value="en-US">
              <div slot="headline">en-US</div>
            </md-select-option>
            <md-select-option value="de-DE">
              <div slot="headline">de-DE</div>
            </md-select-option>
            <md-select-option value="en-AU">
              <div slot="headline">en-AU</div>
            </md-select-option>
            <md-select-option value="en-GB">
              <div slot="headline">en-GB</div>
            </md-select-option>
          </md-outlined-select>
        </div>
      </div>

      <div class="config-section">
        <h3>Branded Voice</h3>
        <div class="form-group">
          <label for="voice-dropdown"
            style="display: block; font-size: 14px; margin-bottom: 8px; font-weight: 500;">Voice</label>
          <select id="voice-dropdown"
            style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid var(--gcp-border); background-color: var(--gcp-surface);">
            <option value="zephyr">zephyr</option>
            <option value="google-1">Google Voice 1</option>
            <option value="google-2">Google Voice 2</option>
          </select>
          <div class="create-voice-link" id="createVoiceBtn">
            + Create a new branded voice
          </div>
          <div class="button-group">
            <input type="file" id="audioFileInput" accept=".wav" style="display: none;">
            <md-outlined-button onclick="document.getElementById('audioFileInput').click()">Upload .wav file
            </md-outlined-button>
          </div>
          <span id="fileName"
            style="font-size: 12px; color: var(--gcp-text-secondary); margin-top: 8px; display: block;"></span>
        </div>
      </div>

      <details class="config-section" hidden>
        <details class="config-section" hidden>
          <summary>
            <h3>Advanced Settings</h3>
          </summary>
          <div class="details-content">
            <b>Transcription</b><br />
            <div class="checkbox-row">
              <md-checkbox id="inputTranscript" touch-target="wrapper"></md-checkbox>
              <label for="inputTranscript">Input Audio Transcripts</label><br />
            </div>
            <div class="checkbox-row">
              <md-checkbox id="outputTranscript" touch-target="wrapper"></md-checkbox>
              <label for="outputTranscript">Output Audio Transcripts</label><br /><br />
            </div>

            <b>Session Resumption</b><br />
            <div class="checkbox-row">
              <md-checkbox id="resumption" touch-target="wrapper"></md-checkbox>
              <label for="resumption">Enable session resumption</label><br />
            </div>
            <md-outlined-text-field id="handle" label="Resumption Handle"></md-outlined-text-field><br /><br />

            <b>VAD & Proactivity</b><br />
            <div class="checkbox-row">
              <md-checkbox id="disableInterruption" touch-target="wrapper"></md-checkbox>
              <label for="disableInterruption">Disable Interruption</label><br />
            </div>
            <div class="checkbox-row">
              <md-checkbox id="disableDetection" touch-target="wrapper"></md-checkbox>
              <label for="disableDetection">Disable Audio Endpointing Detection</label><br />
            </div>
            <div class="checkbox-row">
              <md-checkbox id="proactiveVideo" touch-target="wrapper"></md-checkbox>
              <label for="proactiveVideo">Enable Proactive Video</label><br /><br />
            </div>

            <b class="settings-subtitle">Sampling Rate</b><br />
            <div class="form-grid" style="margin-bottom: 20px;">
              <md-outlined-text-field id="audioInterval" type="number" label="Audio Interval (ms)"
                value="1000"></md-outlined-text-field>
              <md-outlined-text-field id="videoInterval" type="number" label="Video Frame Interval (ms)"
                value="5000"></md-outlined-text-field>
            </div>

            <b class="settings-subtitle">Detection Sensitivity</b><br />
            <div class="form-grid">
              <md-outlined-select label="Start Sensitivity" id="startSensitivity">
                <md-select-option selected value="low">
                  <div slot="headline">low</div>
                </md-select-option>
                <md-select-option value="high">
                  <div slot="headline">high</div>
                </md-select-option>
              </md-outlined-select>
              <md-outlined-select label="End Sensitivity" id="endSensitivity">
                <md-select-option selected value="low">
                  <div slot="headline">low</div>
                </md-select-option>
                <md-select-option value="high">
                  <div slot="headline">high</div>
                </md-select-option>
              </md-outlined-select>
            </div>
          </div>
  </div>
  </aside>
  </div>

  <md-dialog id="dialog" close>
    <div slot="content">
      <span id="dialogMessage">A dialog that is opened by default.</span>
    </div>
  </md-dialog>

  <!-- Branded Voice Creation Modal -->
  <div id="brandedVoiceModal" class="modal-backdrop">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Create a new branded voice</h2>
        <button class="close-button" id="closeModalBtn">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Step 2: Name the voice -->
        <div class="form-group">
          <label for="newVoiceName">Reference voice name</label>
          <input type="text" id="newVoiceName" placeholder="e.g., My custom branded voice"
            style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid var(--gcp-border); background-color: var(--gcp-surface);">
        </div>

        <!-- Step 3: Record reference audio -->
        <div class="form-group">
          <label>Record reference audio</label>
          <div class="record-section">
            Read the following text aloud clearly. A recording of at least 10 seconds is required.
            <p>
              <i>“If this is true then those who tend to think creatively really are somehow different.
                She
                will likely jump for joy and want to skip straight to the honeymoon. The sugar syrup
                should create very fine strands of sugar that drape over the handles. But really in the
                grand scheme of things, this information is insignificant. I let the positive overrule
                the negative.”</i>
            </p>
            <div class="record-controls">
              <button id="recordButton">
                <span class="material-icons">mic</span>
                Record reference voice
              </button>
              <div class="spinner" id="processingSpinner"></div>
              <span id="recordStatus"></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- DOM Element References ---
    const createVoiceBtn = document.getElementById('createVoiceBtn');
    const modal = document.getElementById('brandedVoiceModal');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const newVoiceNameInput = document.getElementById('newVoiceName');
    const recordButton = document.getElementById('recordButton');
    const recordStatus = document.getElementById('recordStatus');
    const processingSpinner = document.getElementById('processingSpinner');
    const voiceDropdown = document.getElementById('voice-dropdown');

    // --- Event Listeners ---
    createVoiceBtn.addEventListener('click', openModal);
    closeModalBtn.addEventListener('click', closeModal);
    window.addEventListener('click', (event) => {
      if (event.target === modal) {
        closeModal();
      }
    });
    recordButton.addEventListener('click', handleRecordClick);

    // --- Functions ---
    function openModal() {
      modal.style.display = 'flex';
      newVoiceNameInput.value = '';
      recordButton.disabled = false;
      recordButton.innerHTML = '<span class="material-icons">mic</span> Record reference voice';
      recordStatus.textContent = '';
      processingSpinner.style.display = 'none';
    }

    function closeModal() {
      modal.style.display = 'none';
    }

    /**
     * Step 3: User clicks the "record" button
     * This function simulates the recording and processing flow.
     */
    function handleRecordClick() {
      // Step 2 validation
      const voiceName = newVoiceNameInput.value.trim();
      if (voiceName === '') {
        alert('Please enter a name for the reference voice.');
        newVoiceNameInput.focus();
        return;
      }

      recordButton.disabled = true;
      let countdown = 12; // Simulating a >10 second recording
      recordStatus.textContent = `Recording... ${countdown}s remaining`;

      const recordInterval = setInterval(() => {
        countdown--;
        recordStatus.textContent = `Recording... ${countdown}s remaining`;
        if (countdown <= 0) {
          clearInterval(recordInterval);
          recordStatus.textContent = 'Recording complete. Processing...';
          recordButton.innerHTML = 'Processing...';
          processingSpinner.style.display = 'block';
          simulateProcessing(voiceName);
        }
      }, 1000);
    }

    function simulateProcessing(voiceName) {
      setTimeout(() => {
        const newOption = document.createElement('option');
        const optionValue = voiceName.toLowerCase().replace(/\s/g, '-');
        newOption.value = optionValue;
        newOption.textContent = voiceName;
        newOption.selected = true; // Select the new voice automatically
        voiceDropdown.appendChild(newOption);

        alert(`New branded voice "${voiceName}" has been created and selected!`);
        closeModal();
      }, 3000); // Simulate 3 seconds of processing
    }
  </script>



</body>

</html>